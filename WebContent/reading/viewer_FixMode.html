<!DOCTYPE html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>ePubReader</title>
<meta name="description" content="">
<meta name="viewport"
	content="initial-scale=0.3, minimum-scale=0.3, maximum-scale=1.0, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<script src="../build/epub.min.js"></script>
<script src="../build/libs/zip.min.js"></script>
<script src="js/epubhelp.js"></script>
<script src="js/libs/jquery-2.1.0.min.js"></script>
<!-- Render -->
<script src="js/epub.min.js"></script>

<!-- Hooks -->
<script src="js/hooks.min.js"></script>

<!-- Reader -->
<script src="js/reader.min.js"></script>

<!-- Plugins -->
<script src="js/plugins/search.js"></script>

<!-- Highlights -->
<script src="js/libs/jquery.highlight.js"></script>
<script src="js/hooks/extensions/highlight.js"></script>

<!-- Full Screen -->
<script src="js/libs/screenfull.min.js"></script>

<!-- CSS -->
<!-- <link rel="stylesheet" href="basic.css"> -->
<link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/popup.css">

<style type="text/css">
body { /* 描画順序最奥 */
	overflow: no;
	background: #eee;
}

#wrapper { /* ビューアフレーム部分(ビューアが入っているフレーム)の設定 */
	width: 800px; /* 幅 */
	height: 85%; /* 高さ */
	max-height: 600px; /* 一般的なスライドの高さ意識で高さ上限600px。オーバーフローはスクロール可に */

	border: 1px solid #000; /* 枠線の色 */
	margin: 20px auto; /* 順に上からのマージン、左からのマージン。title-controll、即ちファンクションボタンエリアサイズに合わせて可変 */
	background: #fff; /* 背景色 */
	border-radius: 0 5px 5px 0; /* 枠線の隅を半径xの円状に丸める */

	overflow-x: hidden; /*横方向は枠内に入りきれない部分は隠す */
	overflow-y: scroll; /*縦方向は枠内に入りきれない部分はスクロールして見れる */

}

#area { /* ビューア部分 */
	margin: -5px auto; /*それぞれ上、左からのマージン*/
	/* 影を付ける */ /*
	-moz-box-shadow: inset 10px 0 20px rgba(0, 0, 0, .1);
	-webkit-box-shadow: inset 10px 0 20px rgba(0, 0, 0, .1);
	box-shadow: inset 10px 0 20px rgba(0, 0, 0, .1);
	*/
	padding: 5px 5px;
}

#memoarea { /* メモエリア部分 */
	height: 100%; /* 高さ */
	width: 50%; /* 幅 */
	margin: 0 auto;
	font-size: 18px;
	overflow: visible;
	/* opacity: .5; */
}

#jumparea { /* ジャンプ系エリア(目次ジャンプ、検索ジャンプ) */
	margin: 20px 20px; /* 順に上から、左からのマージン */
}

</style>
<script>
	"use strict";
	var oldChapter = 0, oldPage = 1;
	// BookmarkedPages["chapter-pages"]=true(bookmarked) or false(not bookmarked)
	// ex. BookmarkedPages[1-2]=true means "chapter 1 page 2 is bookmarked"
	var BookmarkedPages = new Object();
	// HighlightedStrings
	var HighlightedStrings = new Object();
	//memo
	var memorandum = new Object();

	var query = window.location.search.substring(1);
	var element = query.split('=');
	//var paramName = decodeURIComponent( element[ 0 ] );
	var paramValue = decodeURIComponent(element[1]);
	//ウィンドウサイズ
	var windowWidth = window.innerWidth;
	var windowHeight = window.innerHeight;

	//描画時の幅と高さを指定
	var Book = ePub("../books/unzipped/" + paramValue + "/", {
		width : 768,
		height : 1024,
		spreads : false
	});

	$(function() {
		$('#close').click(function() { //CLOSEボタンの処理
			document.location = "../index.php";
		});
		$('#changeview').click( //changeviewボタンの処理
						function() {
							var query = window.location.search.substring(1);
							var element = query.split('=');
							//var paramName = decodeURIComponent( element[ 0 ] );
							var paramValue = decodeURIComponent(element[1]);
							document.location = "viewer_ReflowMode.html?book-selection="
									+ paramValue;
						});
		$('#bookmark').click(function() { //bookmarkボタンの処理(詳細はepubhelp.js内のBookmarkPage関数で定義)
			BookmarkPage();
		});
		$('#memo').click(function() { //memoボタンの処理(詳細はepubhelp.js内のmemoFunc関数で定義)
			memoFunc();
		});
		$('#saveBtn').click(function() { //memo保存用ボタンの処理(詳細はepubhelp.js内のsaveMemo関数で定義)
			saveMemo();
		});
		$('#searchBtn').click(function() { //検索ボタンの処理(詳細はepubhelp.js内のsaveMemo関数で定義)
			searchFunc();
		});
		$("#memorandum").each(function(){ //メモの内容が変わった際に呼び出される処理
			$(this).bind('keyup', memoChanged(this));
		});
		$('html').keyup(function(e){
			switch(e.which){
				case 37: // 「←」を押したとき
					Book.prevPage();
					break;

				case 38: // 「↑」を押したとき
					break;

				case 39: // 「→」を押したとき
					Book.nextPage();
					break;

				case 40: //「↓」を押したとき
					break;

			}
		});
	});

	Book.getMetadata().then(function(meta){
		document.title = meta.bookTitle+" – "+meta.creator;
	});
	Book.getToc().then(function(toc){
		var $select = document.getElementById("toc"),
		docfrag = document.createDocumentFragment();
		toc.forEach(function(chapter) {
		var option = document.createElement("option");
		option.textContent = chapter.label;
		option.ref = chapter.href;
		docfrag.appendChild(option);
	});
	$select.appendChild(docfrag);
	$select.onchange = function(){
		var index = $select.selectedIndex,
		url = $select.options[index].ref;
		Book.goto(url);
		return false;
	}
	});
	Book.ready.all.then(function(){
	document.getElementById("loader").style.display = "none";
	});


</script>
</head>



<body>

<!--
	<div id="sidebar">
		<div id="panels">
			<input id="searchBox" placeholder="search" type="search">
			<a id="show-Search" class="show_view icon-search" data-view="Search">Search</a>
			<a id="show-Toc" class="show_view icon-list-1 active" data-view="Toc">TOC</a>
			<a id="show-Bookmarks" class="show_view icon-bookmark" data-view="Bookmarks">Bookmarks</a>
			<a id="show-Notes" class="show_view icon-edit" data-view="Notes">Notes</a>
		</div>
		<div id="tocView" class="view">
		</div>
		<div id="searchView" class="view">
			<ul id="searchResults"></ul>
		</div>
		<div id="bookmarksView" class="view">
			<ul id="bookmarks"></ul>
		</div>
		<div id="notesView" class="view">
			<div id="new-note">
				<textarea id="note-text"></textarea>
				<button id="note-anchor">Anchor</button>
			</div>
			<ol id="notes"></ol>
		</div>
	</div>
-->
	<div id="main">
		<div id="jumparea">
			<select id="toc"></select><br>
			<input type="text" id="searchTextBox" />
			<input type="button" id="searchBtn" value="Search"/><br>
			<div id="searchView">
				<ul id="searchResults"></ul>
			</div>
		</div>
		<div id="titlebar">
			<!-- サイドバーオープナ
			<div id="opener">
				<a id="slider" class="icon-menu"></a>
			</div>
			-->

			<!--
			<div id="metainfo">
				<span id="book-title"></span> <span id="title-seperator">&nbsp;&nbsp;?&nbsp;&nbsp;</span>
				<span id="chapter-title"></span>
			</div>
			-->
			<div id="memoarea">
				<textarea id="memorandum" cols="5" rows="5" style="width:90%;height:100%; font-size:18px; visibility: hidden;"></textarea>
				<input type="button" id="saveBtn" value="SAVE" style="visibility: hidden" />
			</div>
			<div id="title-controls">
				<!-- actions are written at EPUBJS.reader.ControlsController (in reader.min.js ) -->
				<a id="bookmark" class="icon-bookmark-empty" title="Bookmark"></a>
				<a id="highlighting" href="javascript:HighlightString();" title="Highlight">
					<font color="black" size="2">
						<span style="background-color: yellow">abc</span>
					</font>
				</a>
				<a id="memo" class="icon-edit" title="show/take a memo"></a>
				<!-- <a id="changeview" class="icon-link" title="Reflow Mode"></a> -->
				<a id="test" title="debug" href="javascript:testFunc();">?</a>
				<font color="red">
					<a id="close" class="icon-cancel-circled" title="Close"></a>
				</font>
				<div id="bookmarker" style="visibility: hidden">
					<img src="img/bookmarker.png" />
				</div>
			</div>

		</div>
		<div id="prev" onclick="Book.prevPage();" class="arrow"><</div>
		<div id="wrapper">
			<div id="area"></div>
		</div>
		<div id="next" onclick=" Book.nextPage();" class="arrow">></div>
		<div id="loader"><img src="../reader/img/loader.gif"></div>
	</div>

	<script>
		Book.renderTo("area").then(function() {

		});
	</script>

</body>
</html>